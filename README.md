# ragp
Model Documentation: Biophysical Modelling of Neuronal Phenotypes of the Right Atrial Ganglionic Plexus from Single Neuron Transcriptomics

Context of use: Simulation of single compartment neuron electrical activity in the RAGP.

Instructions for reproducing figures using data generated by models:

A.	Figure 2 and 3
  1.	Clone GitHub repository and checkout to tag-v2.0.2
git clone https://github.com/suny-downstate-medical-center/ragp.git
  2.   Figure 2: Execute ct_genes.py, which reads data from threshold.py
  3.   Figure 3: Run Tdata_plots.py, which reads the data from tdata_all_15.csv. Also run Tdata_plots_thresholds.py for plots showing the alternative Ct thresholds tested.

B.	Figure 4
  1.   Read data file 22aug25b_allData.json
  2.   Execute the 'classification' function in scAnalysis.py
  3.   Download classification.json and classification_firing_sequence.py
  4.   Run classification_firing_sequence.py
  5.  To produce the distribution of firing types at different thresholds, use analysis_ct.py. The dataFolder, batchLabel, paramFile, and filename must be updated. For example for a Ct threshold of 13, use dataFolder = "24jan24_13", batchLabel = '24jan24_13', paramFile = 'params_13.csv', filename = 'your_working_directory_path//24jan24_13_allData.json'

 Note that a large amount of RAM is required to run this file 
 
C.	Figure 5
  1.	Read data file 22aug25b_allData.json 
  2.	Execute the 'IV' function in scAnalysis.py  
  Note that a large amount of RAM is required to run this file 

Instructions for running the models: 
Detailed instructions for running the model in NetPyNE and on the O2S2PARC platform are as follows:

I. NetPyNE implementation
1.	Open a new Terminal window
2.	Make a new directory into which to clone the repository
3.	Clone GitHub repository and checkout to tag-v2.0.2
git clone https://github.com/suny-downstate-medical-center/ragp.git
4.	Install NEURON and NetPyNE: 
pip3 install NEURON / pip install NEURON
pip3 install netpyne / pip3 install netpyne
5.	Compile mod files: 
nrnivmodl mod
6.	On successful compilation, x86_64 folder is created
7.	In order to run a single simulation, execute the following command:
nrniv -python init.py
8.	In order to run a batch simulation, MPI installation is mandatory: 
mpiexec --oversubscribe -np 32 nrniv -python -mpi batch.py

    a.	Once the simulations are complete, run scAnalysis.py
ipython -i scAnalysis.py
  
    b.	Create _allData.json file by running the function 
readBatchData(dataFolder, batchLabel, paramFile = 'params.csv')
  
    c.	Load the _allData.json file by running the function 
readAllData(jsonfilename)
  
    d.	Analyse the data in _allData.json using the functions in scAnalysis.py
10.	In order to run sobol sampling on the parameter space, execute sobol.py, following which a csv file (default name: params.csv) is generated that will contain the parameter values
11.	In order to plot the binarized transcriptomics data, execute 
ipython Tdata_plots.py
12. In order to create the bar plot that compares Ct values, execute
ipython ct_genes.py

II. O2S2PARC implementation:  
1.	Login to https://osparc.io/
2.	Use the Jupyter Octave+Python Math service from the Dashboard
3.	Clone the repository from GitHub checkout to tag-v2.0.2: 
https://github.com/suny-downstate-medical-center/ragp.git
4.	Launch Terminal
5.	Type the following commands on the Terminal

    a.	cd work/ragp
  
    b.	pip install --quiet NEURON
  
    c.	pip install --quiet netpyne
7.	Resume the steps from I.5. 


Additional analysis:

Effect of varying sodium channel inactivation parameter (h_inf) on electrophysiological behaviour
  1. Use analysis_ct.py
  2. Change the following variables dataFolder = "25jan24_scn1a_-20", batchLabel = '25jan24_scn1a_-20', paramFile = 'params.csv', filename = '//lustre//ogunnaike//users//2420//matlab_example//ragp//batch//25jan24_scn1a_-20_allData.json' for simulating a -20% change in h_inf. There are also data available for a +20% change in h_inf

Note: These json files are not available on Github due to their large size, but are available on the SPARC portal (10.26275/cy9w-ttjn)




